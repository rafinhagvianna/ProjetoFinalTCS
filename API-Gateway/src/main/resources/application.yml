server:
    port: 9000
spring:
    application:
        name: API-Gateway

cloud:
    gateway:
        # Habilita a busca de servi�os via Eureka
        discovery:
            locator:
                enabled: true
                lower-case-service-id: true


        # Rotas expl�citas (mais controle)
        routes:
            - id: catalogo-service-route
                # lb = Load Balancer. Roteia para o servi�o com este nome no Eureka
              uri: lb://CATALOGO-SERVICE
              predicates:
                  # Qualquer requisi��o para /catalogo/** ser� enviada para o servi�o acima
                  - Path=/catalogo/**

            - id: agendamento-service-route
              uri: lb://AGENDAMENTO-SERVICE
              predicates:
                  - Path=/agendamentos/**

            - id: triagem-service-route
              uri: lb://TRIAGEM-SERVICE
              predicates:
                  - Path=/triagem/**

            - id: atendimento-service-route
              uri: lb://ATENDIMENTO-SERVICE
              predicates:
                  - Path=/atendimento/**

            - id: cadastro-cliente-service-route
              uri: lb://CADASTROCLIENTE-SERVICE
              predicates:
                  - Path=/clientes/**

            - id: cadastro-funcionario-service-route
              uri: lb://CADASTROFUNCIONARIO-SERVICE
              predicates:
                  - Path=/funcionarios/**

        # --- CONFIGURA��O DE CORS PARA O FRONT-END ---
        globalcors:
            cors-configurations:
                '[/**]': # Aplica para todas as rotas
                    allowed-origins: "http://localhost:4200" # URL do seu front-end Angular
                    allowed-methods:
                        - GET
                        - POST
                        - PUT
                        - DELETE
                        - OPTIONS
                    allowed-headers: "*"

# --- CONFIGURA��O DO EUREKA CLIENT ---
eureka:
    client:
        service-url:
            # Endere�o do seu Eureka Server
            defaultZone: http://localhost:8761/eureka/
        # O Gateway precisa buscar o registro de servi�os
        fetch-registry: true
        # � bom registrar o pr�prio Gateway no Eureka para monitoramento
        register-with-eureka: true

# --- SUAS CONFIGURA��ES DE SWAGGER (adaptadas para o novo roteamento) ---
springdoc:
    swagger-ui:
        path: /swagger-ui.html
        # Agora o Swagger-UI vai buscar as documenta��es dos microsservi�os atrav�s das rotas do Gateway
        urls:
            - name: Catalogo Service
              url: /catalogo/v3/api-docs
            - name: Agendamento Service
              url: /agendamentos/v3/api-docs
            - name: Triagem Service
              url: /triagem/v3/api-docs
            - name: Atendimento Service
              url: /atendimento/v3/api-docs
            - name: CadastroCliente Service
              url: /clientes/v3/api-docs
            - name: CadastroFuncionario Service
              url: /funcionarios/v3/api-docs

## Actuator Endpoints
#management.health.circuitbreakers.enabled=true
#management.endpoints.web.exposure.include=*
#management.endpoint.health.show-details=always
#
## Resilience4j Properties
#resilience4j.circuitbreaker.configs.default.register-health-indicator=true
#resilience4j.circuitbreaker.configs.default.sliding-window-type=COUNT_BASED
#resilience4j.circuitbreaker.configs.default.sliding-window-size=10
#resilience4j.circuitbreaker.configs.default.failureRateThreshold=50
#resilience4j.circuitbreaker.configs.default.waitDurationInOpenState=5s
#resilience4j.circuitbreaker.configs.default.permittedNumberOfCallsInHalfOpenState=3
#resilience4j.circuitbreaker.configs.default.automaticTransitionFromOpenToHalfOpenEnabled=true
#resilience4j.circuitbreaker.configs.default.minimum-number-of-calls=5
#
## Resilience4j Timeout Properties
#resilience4j.timeLimiter.configs.default.timeout-duration=3s
#
#
## Resilience4j Retry Properties
#resilience4j.retry.configs.default.max-attempts=3
#resilience4j.retry.configs.default.wait-duration=2s